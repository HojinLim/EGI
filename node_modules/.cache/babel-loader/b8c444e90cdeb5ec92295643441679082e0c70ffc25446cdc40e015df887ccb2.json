{"ast":null,"code":"var _jsxFileName = \"C:\\\\React\\\\team_one\\\\src\\\\components\\\\common\\\\Header.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { atom, useAtom } from 'jotai';\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\nimport Login, { userAtom, userEmailAtom } from '../user/Login';\nimport { getUserInfo, sigOutService } from '../../services/supabase/auth';\nimport icon from '../../image/icon.png';\nimport * as S from './Styled.Header';\nimport { Link } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst jotaiUserDataAtom = atom(null);\nconst Header = () => {\n  _s();\n  const queryClient = useQueryClient();\n  const [loginModal, setLoginModal] = useState(false);\n  const [showLogoutButton, setShowLogoutButton] = useState(false);\n  const [, setUser] = useAtom(userAtom);\n  const [userEmail, setUserEmail] = useAtom(userEmailAtom);\n  const [jotaiUserData, setJotaiUserData] = useAtom(jotaiUserDataAtom);\n  const {\n    isLoading,\n    isError,\n    data: userData\n  } = useQuery(['users', userEmail], () => getUserInfo(userEmail), {\n    staleTime: 300000,\n    enabled: userEmail !== null // userEmail이 있을 때에만 useQuery 실행\n  });\n\n  const logoutMutation = useMutation(() => sigOutService(), {\n    onSuccess: () => {\n      setJotaiUserData(null); // 로그아웃 시 jotaiUserData를 null로 업데이트\n      localStorage.removeItem('jotaiUserData');\n      queryClient.invalidateQueries(['users', userEmail]);\n    }\n  });\n  const signOutHandler = async () => {\n    try {\n      setUser(null); // userData 초기화\n      setUserEmail('');\n      await logoutMutation.mutateAsync();\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  useEffect(() => {\n    if (userData) {\n      const userDataString = JSON.stringify(userData);\n      localStorage.setItem('jotaiUserData', userDataString);\n      setJotaiUserData(userData);\n    }\n  }, [userData]);\n  useEffect(() => {\n    const storedUserData = localStorage.getItem('jotaiUserData');\n    if (storedUserData) {\n      const parsedUserData = JSON.parse(storedUserData);\n      setJotaiUserData(parsedUserData);\n    }\n  }, []);\n  const showModal = () => {\n    setLoginModal(true);\n  };\n  const toggleLogoutButton = () => {\n    setShowLogoutButton(prevState => !prevState);\n  };\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"\\uB370\\uC774\\uD130 \\uB85C\\uB529 \\uC911\\uC785\\uB2C8\\uB2E4.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 12\n    }, this);\n  }\n  if (isError) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"\\uB370\\uC774\\uD130\\uB97C \\uBD88\\uB7EC\\uC624\\uB294 \\uB3D9\\uC548 \\uC624\\uB958\\uAC00 \\uBC1C\\uC0DD\\uD588\\uC2B5\\uB2C8\\uB2E4\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(S.HeaderContainer, {\n    children: [/*#__PURE__*/_jsxDEV(S.Logo, {\n      src: icon\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [jotaiUserData ? /*#__PURE__*/_jsxDEV(S.ProfileWrapper, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: jotaiUserData ? /*#__PURE__*/_jsxDEV(S.ProfileBox, {\n            children: [/*#__PURE__*/_jsxDEV(S.ProfileImg, {\n              src: `${process.env.REACT_APP_SUPABASE_STORAGE_URL}${jotaiUserData.profileimg}`,\n              alt: \"Profile\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 90,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(S.NickName, {\n              children: jotaiUserData.nickname\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 19\n            }, this)]\n          }, jotaiUserData.uid, true, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 17\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(S.ButtonBox, {\n          children: /*#__PURE__*/_jsxDEV(S.ToggleButtonWrapper, {\n            children: [/*#__PURE__*/_jsxDEV(S.ToggleButton, {\n              onClick: toggleLogoutButton,\n              children: \"\\u25BC\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 17\n            }, this), showLogoutButton && /*#__PURE__*/_jsxDEV(S.LogoutButton, {\n              onClick: signOutHandler,\n              children: \"Logout\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 101,\n              columnNumber: 38\n            }, this), /*#__PURE__*/_jsxDEV(Link, {\n              to: \"/mypage\",\n              children: \"\\uB9C8\\uC774\\uD398\\uC774\\uC9C0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 102,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(S.LoginButton, {\n        onClick: showModal,\n        children: \"Login\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this), loginModal && /*#__PURE__*/_jsxDEV(Login, {\n        setLoginModal: setLoginModal\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 24\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n};\n_s(Header, \"zIsd15+c1auDFCu2dZgtcMCbln8=\", false, function () {\n  return [useQueryClient, useAtom, useAtom, useAtom, useQuery, useMutation];\n});\n_c = Header;\nexport default Header;\nvar _c;\n$RefreshReg$(_c, \"Header\");","map":{"version":3,"names":["React","useEffect","useState","atom","useAtom","useMutation","useQuery","useQueryClient","Login","userAtom","userEmailAtom","getUserInfo","sigOutService","icon","S","Link","jsxDEV","_jsxDEV","jotaiUserDataAtom","Header","_s","queryClient","loginModal","setLoginModal","showLogoutButton","setShowLogoutButton","setUser","userEmail","setUserEmail","jotaiUserData","setJotaiUserData","isLoading","isError","data","userData","staleTime","enabled","logoutMutation","onSuccess","localStorage","removeItem","invalidateQueries","signOutHandler","mutateAsync","error","console","userDataString","JSON","stringify","setItem","storedUserData","getItem","parsedUserData","parse","showModal","toggleLogoutButton","prevState","children","fileName","_jsxFileName","lineNumber","columnNumber","HeaderContainer","Logo","src","ProfileWrapper","ProfileBox","ProfileImg","process","env","REACT_APP_SUPABASE_STORAGE_URL","profileimg","alt","NickName","nickname","uid","ButtonBox","ToggleButtonWrapper","ToggleButton","onClick","LogoutButton","to","LoginButton","_c","$RefreshReg$"],"sources":["C:/React/team_one/src/components/common/Header.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { atom, useAtom } from 'jotai';\r\nimport { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';\r\nimport Login, { userAtom, userEmailAtom } from '../user/Login';\r\nimport { getUserInfo, sigOutService } from '../../services/supabase/auth';\r\nimport icon from '../../image/icon.png';\r\nimport * as S from './Styled.Header';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport type { UserType } from '../../types/supabase';\r\n\r\nconst jotaiUserDataAtom = atom<Omit<UserType, 'password'> | null>(null);\r\n\r\nconst Header = () => {\r\n  const queryClient = useQueryClient();\r\n  const [loginModal, setLoginModal] = useState(false);\r\n\r\n  const [showLogoutButton, setShowLogoutButton] = useState(false);\r\n  const [, setUser] = useAtom(userAtom);\r\n  const [userEmail, setUserEmail] = useAtom(userEmailAtom);\r\n  const [jotaiUserData, setJotaiUserData] = useAtom(jotaiUserDataAtom);\r\n\r\n  const {\r\n    isLoading,\r\n    isError,\r\n    data: userData\r\n  } = useQuery<Omit<UserType, 'password'> | null>(['users', userEmail], () => getUserInfo(userEmail), {\r\n    staleTime: 300000,\r\n    enabled: userEmail !== null // userEmail이 있을 때에만 useQuery 실행\r\n  });\r\n\r\n  const logoutMutation = useMutation(() => sigOutService(), {\r\n    onSuccess: () => {\r\n      setJotaiUserData(null); // 로그아웃 시 jotaiUserData를 null로 업데이트\r\n      localStorage.removeItem('jotaiUserData');\r\n      queryClient.invalidateQueries(['users', userEmail]);\r\n    }\r\n  });\r\n\r\n  const signOutHandler = async () => {\r\n    try {\r\n      setUser(null); // userData 초기화\r\n      setUserEmail('');\r\n      await logoutMutation.mutateAsync();\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (userData) {\r\n      const userDataString = JSON.stringify(userData);\r\n      localStorage.setItem('jotaiUserData', userDataString);\r\n      setJotaiUserData(userData);\r\n    }\r\n  }, [userData]);\r\n\r\n  useEffect(() => {\r\n    const storedUserData = localStorage.getItem('jotaiUserData');\r\n    if (storedUserData) {\r\n      const parsedUserData = JSON.parse(storedUserData);\r\n      setJotaiUserData(parsedUserData);\r\n    }\r\n  }, []);\r\n\r\n  const showModal = () => {\r\n    setLoginModal(true);\r\n  };\r\n\r\n  const toggleLogoutButton = () => {\r\n    setShowLogoutButton((prevState) => !prevState);\r\n  };\r\n  if (isLoading) {\r\n    return <div>데이터 로딩 중입니다.</div>;\r\n  }\r\n\r\n  if (isError) {\r\n    return <div>데이터를 불러오는 동안 오류가 발생했습니다</div>;\r\n  }\r\n\r\n  return (\r\n    <S.HeaderContainer>\r\n      <S.Logo src={icon} />\r\n      <div>\r\n        {jotaiUserData ? (\r\n          <S.ProfileWrapper>\r\n            <div>\r\n              {jotaiUserData ? (\r\n                <S.ProfileBox key={jotaiUserData.uid}>\r\n                  <S.ProfileImg\r\n                    src={`${process.env.REACT_APP_SUPABASE_STORAGE_URL}${jotaiUserData.profileimg}`}\r\n                    alt=\"Profile\"\r\n                  />\r\n                  <S.NickName>{jotaiUserData.nickname}</S.NickName>\r\n                </S.ProfileBox>\r\n              ) : null}\r\n            </div>\r\n            <S.ButtonBox>\r\n              <S.ToggleButtonWrapper>\r\n                <S.ToggleButton onClick={toggleLogoutButton}>▼</S.ToggleButton>\r\n                {showLogoutButton && <S.LogoutButton onClick={signOutHandler}>Logout</S.LogoutButton>}\r\n                <Link to=\"/mypage\">마이페이지</Link>\r\n              </S.ToggleButtonWrapper>\r\n            </S.ButtonBox>\r\n          </S.ProfileWrapper>\r\n        ) : (\r\n          <S.LoginButton onClick={showModal}>Login</S.LoginButton>\r\n        )}\r\n        {loginModal && <Login setLoginModal={setLoginModal} />}\r\n      </div>\r\n    </S.HeaderContainer>\r\n  );\r\n};\r\n\r\nexport default Header;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}